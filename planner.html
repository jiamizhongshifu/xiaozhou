<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ë°åÁ®ãËßÑÂàí - ÊóÖË°åËßÑÂàíÂ∏àÂ∞èÂë®</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="css/chat.css">
    <link rel="stylesheet" href="css/nav-menu.css">
    <style>
        body {
            font-family: 'SF Pro Display', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
        }
        .chat-messages {
            height: calc(100vh - 200px);
            overflow-y: auto;
            display: flex;
            flex-direction: column;
        }
        .message {
            display: flex;
            flex-direction: column;
            margin-bottom: 16px;
            max-width: 100%;
        }
        .message-content {
            padding: 12px 16px;
            border-radius: 18px;
            max-width: 85%;
        }
        .user-message {
            align-self: flex-end;
        }
        .user-message .message-content {
            background-color: #0071e3;
            color: white;
            border-bottom-right-radius: 4px;
            align-self: flex-end;
        }
        .bot-message {
            align-self: flex-start;
        }
        .bot-message .message-content {
            background-color: #f2f2f7;
            color: #1c1c1e;
            border-bottom-left-radius: 4px;
            align-self: flex-start;
        }
        .typing-dots .dot {
            animation-duration: 1.4s;
            animation-iteration-count: infinite;
            animation-fill-mode: both;
        }
        .suggestion-btn {
            white-space: nowrap;
        }
        #suggestion-buttons {
            overflow-x: auto;
            scrollbar-width: none;
            -ms-overflow-style: none;
        }
        #suggestion-buttons::-webkit-scrollbar {
            display: none;
        }
        
        /* Ë∞ÉÊï¥ËÅäÂ§©Âå∫ÂüüÁöÑÂÆö‰ΩçÔºåÈÅøÂÖçË¢´ÂØºËà™Ê†èÈÅÆÊå° */
        .h-screen {
            height: calc(100vh - 70px);
            margin-top: 70px;
        }

        .itinerary-container {
            background-color: #f8f9fa;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            margin: 15px 0;
            width: 100%;
        }

        .section-title {
            font-weight: 600;
            color: #333;
            margin-bottom: 10px;
        }

        .itinerary-overview {
            background-color: #f0f7ff;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            border-left: 4px solid #0071e3;
        }

        .overview-list {
            margin: 0;
            padding-left: 20px;
            display: flex;
            flex-wrap: wrap;
        }

        .overview-list li {
            margin-bottom: 5px;
            padding-right: 15px;
            width: 50%;
            box-sizing: border-box;
        }

        .overview-list li strong {
            color: #0071e3;
        }

        .itinerary-days {
            padding: 15px;
        }

        /* Êñ∞Â¢û - Ê∞¥Âπ≥Âç°ÁâáÊªöÂä® */
        .day-cards-container {
            display: flex;
            overflow-x: auto;
            padding: 10px 0;
            margin: 0 -10px;
            scroll-behavior: smooth;
            -webkit-overflow-scrolling: touch;
            scrollbar-width: thin;
        }

        .day-cards-container::-webkit-scrollbar {
            height: 6px;
        }

        .day-cards-container::-webkit-scrollbar-thumb {
            background-color: rgba(0,113,227,0.5);
            border-radius: 3px;
        }

        .day-cards-container::-webkit-scrollbar-track {
            background-color: #f0f0f0;
            border-radius: 3px;
        }

        /* Êó•Âç°ÁâáÊ†∑ÂºèË∞ÉÊï¥‰∏∫Ê∞¥Âπ≥Â∏ÉÂ±Ä */
        .day-card {
            background-color: white;
            border-radius: 8px;
            margin: 0 10px;
            overflow: hidden;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            min-width: 280px;
            max-width: 280px;
            flex-shrink: 0;
            display: flex;
            flex-direction: column;
            border: 1px solid #e1e4e8;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .day-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }

        .day-title {
            background-color: #0071e3;
            color: white;
            padding: 10px 15px;
            font-weight: 600;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .day-content {
            padding: 12px 15px;
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        /* Âº∫Ë∞ÉÈáçË¶Å‰ø°ÊÅØ */
        .highlight {
            background-color: #fff8e6;
            border-left: 3px solid #fdbe33;
            padding: 8px 12px;
            margin: 8px 0;
            font-weight: 500;
        }

        .key-info {
            color: #0071e3;
            font-weight: bold;
        }

        .info-title {
            font-size: 1.1em;
            font-weight: 600;
            color: #333;
            margin-bottom: 6px;
            border-bottom: 2px solid #0071e3;
            padding-bottom: 4px;
            display: inline-block;
        }

        .time-slot {
            font-weight: 600;
            color: #0071e3;
            margin-right: 10px;
            min-width: 50px;
            display: inline-block;
            flex-shrink: 0;
            background-color: #e6f2ff;
            padding: 2px 6px;
            border-radius: 4px;
        }

        .address-info {
            font-size: 0.85em;
            color: #666;
            margin-top: 4px;
            background-color: #f5f5f5;
            padding: 4px 8px;
            border-radius: 4px;
        }

        .tips-info {
            margin-top: 8px;
            padding-top: 8px;
            border-top: 1px dashed #e1e4e8;
            font-style: italic;
            color: #555;
        }

        .tips-info::before {
            content: "üí° ";
        }

        .schedule-list {
            margin: 0;
            padding-left: 5px;
            list-style-type: none;
        }

        .schedule-list li {
            margin-bottom: 12px;
            position: relative;
            display: flex;
            align-items: flex-start;
        }

        .schedule-list li:before {
            content: "‚Ä¢";
            position: absolute;
            left: -10px;
            color: #0071e3;
            font-size: 18px;
        }

        .schedule-item {
            display: flex;
            width: 100%;
        }

        .activity-content {
            display: flex;
            flex-direction: column;
            flex: 1;
        }

        .activity-main {
            font-weight: 600;
            color: #333;
            margin-bottom: 4px;
        }

        .activity-desc {
            font-size: 0.9em;
            color: #555;
            margin-bottom: 8px;
            line-height: 1.4;
        }

        .activity-text {
            flex: 1;
        }

        .time-paragraph {
            display: flex;
            margin-bottom: 10px;
            align-items: baseline;
        }

        .source-indicator {
            display: inline-flex;
            align-items: center;
            margin-top: 10px;
            padding: 4px 8px;
            background-color: #f0f0f0;
            border-radius: 4px;
            font-size: 0.8em;
            color: #666;
        }

        .source-indicator.deepseek-source {
            background-color: #e6f4ea;
            color: #1e7e34;
        }

        .source-indicator i {
            margin-right: 5px;
        }

        .itinerary-title {
            border-bottom: 2px solid #0071e3;
            padding-bottom: 10px;
            margin-bottom: 15px;
            color: #0071e3;
        }

        .additional-info {
            padding: 15px;
            background-color: #fafafa;
            border-top: 1px solid #e1e4e8;
        }

        .info-section {
            margin-bottom: 15px;
        }

        .info-section:last-child {
            margin-bottom: 0;
        }

        /* ÊéßÂà∂ÊåâÈíÆ */
        .scroll-controls {
            display: flex;
            justify-content: center;
            margin-top: 10px;
            gap: 10px;
        }

        .scroll-button {
            background-color: #0071e3;
            color: white;
            border: none;
            border-radius: 50%;
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .scroll-button:hover {
            background-color: #005bb5;
        }

        .scroll-button:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
        }

        /* Â¢ûÂä†ÂàÜÈöîÁ∫ø */
        .section-divider {
            height: 1px;
            background: linear-gradient(to right, transparent, #0071e3, transparent);
            margin: 20px 0;
        }
        
        /* Ë°åÁ®ãÊìç‰ΩúÊåâÈíÆÊ†∑Âºè */
        .itinerary-actions {
            display: flex;
            gap: 10px;
            margin: 15px 0;
        }
        
        .share-button, .regenerate-button {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 8px 15px;
            background-color: #f0f0f0;
            color: #333;
            border: none;
            border-radius: 6px;
            font-size: 0.9em;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .share-button:hover, .regenerate-button:hover {
            background-color: #e0e0e0;
        }
        
        .share-button i, .regenerate-button i {
            margin-right: 6px;
        }
        
        .regenerate-button {
            background-color: #e6f3ff;
            color: #0071e3;
        }
        
        .regenerate-button:hover {
            background-color: #d0e8ff;
        }

        /* Ë°åÁ®ãÁîüÊàêÁä∂ÊÄÅÊ†∑Âºè */
        .generating-message {
            display: flex;
            align-items: center;
            padding: 12px;
            background-color: #f8f9fa;
            border-radius: 8px;
            margin-bottom: 10px;
        }
        
        .loading-spinner {
            width: 24px;
            height: 24px;
            border: 3px solid #e9ecef;
            border-top: 3px solid #007bff;
            border-radius: 50%;
            margin-right: 12px;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* È™åËØÅÊèêÁ§∫Ê†∑Âºè */
        .validation-note {
            margin-top: 12px;
            padding: 10px;
            background-color: #e8f5e9;
            border-left: 4px solid #4caf50;
            border-radius: 4px;
            font-size: 14px;
            color: #2e7d32;
        }
        
        .validation-note i {
            margin-right: 8px;
        }
        
        /* ÂÜÖÂÆπË°•ÂÖ®Ê†∑Âºè */
        .completion-highlight {
            background-color: rgba(255, 235, 59, 0.2);
            border-bottom: 1px dashed #ffc107;
            padding: 0 2px;
        }
        
        /* Ë°åÁ®ãÁîüÊàêËøõÂ∫¶ÊåáÁ§∫Âô®CSSË°•ÂÖÖ */
        .itinerary-progress-container {
            animation: slide-in 0.3s ease-out;
        }
        
        @keyframes slide-in {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        /* Â¢ûÂº∫ÂèØËßÅÊÄßÂíåÊ≠•È™§ÊåáÁ§∫ */
        .progress-steps::before {
            content: '';
            position: absolute;
            top: 6px;
            left: 10%;
            width: 80%;
            height: 2px;
            background-color: #ddd;
            z-index: 0;
        }
        
        .progress-steps {
            position: relative;
        }
        
        .step-indicator {
            position: relative;
            z-index: 1;
        }
        
        /* ÂàÜ‰∫´ÂíåÈáçÊñ∞ÁîüÊàêÊåâÈíÆÊ†∑ÂºèÂ¢ûÂº∫ */
        .share-button, .regenerate-button {
            transition: transform 0.2s ease;
        }
        
        .share-button:hover, .regenerate-button:hover {
            transform: translateY(-2px);
        }
        
        .share-button:active, .regenerate-button:active {
            transform: translateY(1px);
        }
        
        /* Ëá™Âä®Ë°•ÂÖ®‰ø°ÊÅØÊ†∑Âºè */
        .auto-completed-day {
            position: relative;
        }
        
        .auto-completed-day::after {
            content: 'Ëá™Âä®Ë°•ÂÖÖ';
            position: absolute;
            top: 10px;
            right: 10px;
            font-size: 11px;
            background-color: #ffeb3b;
            color: #212121;
            padding: 2px 6px;
            border-radius: 10px;
            opacity: 0.7;
        }

        /* Ë°åÁ®ãÂ±ïÁ§∫‰ºòÂåñ - TabÂØºËà™ÂíåÊäòÂè†ÂäüËÉΩ */
        
        /* TabÂØºËà™Á≥ªÁªü */
        .itinerary-tabs {
            margin-top: 20px;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            overflow: hidden;
            background: #fff;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }
        
        .tabs-nav {
            display: flex;
            background: #f5f5f7;
            border-bottom: 1px solid #e0e0e0;
        }
        
        .tab-btn {
            padding: 12px 20px;
            border: none;
            background: transparent;
            cursor: pointer;
            font-weight: 500;
            color: #333;
            transition: all 0.2s;
            position: relative;
        }
        
        .tab-btn:hover {
            background: rgba(0,0,0,0.03);
        }
        
        .tab-btn.active {
            color: #007aff;
            background: #fff;
            border-bottom: 2px solid #007aff;
        }
        
        .tabs-content {
            padding: 20px;
        }
        
        .tab-pane {
            display: none;
        }
        
        .tab-pane.active {
            display: block;
        }
        
        /* Êó•ÊúüÂØºËà™Ê†∑Âºè */
        .daily-nav {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 20px;
            border-bottom: 1px solid #eee;
            padding-bottom: 15px;
        }
        
        .day-nav-btn {
            padding: 8px 15px;
            border: 1px solid #ddd;
            border-radius: 20px;
            background: #f8f8f8;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .day-nav-btn:hover {
            background: #f0f0f0;
        }
        
        .day-nav-btn.active {
            background: #007aff;
            color: white;
            border-color: #007aff;
        }
        
        /* ÊØèÊó•ÂÜÖÂÆπÊ†∑Âºè */
        .daily-content {
            position: relative;
        }
        
        .day-detail {
            display: none;
            margin-bottom: 20px;
            background: #fff;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        
        .day-detail.active {
            display: block;
        }
        
        .day-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 20px;
            border-bottom: 1px solid #eee;
            background: #f9f9f9;
            border-radius: 8px 8px 0 0;
        }
        
        .day-header h3 {
            margin: 0;
            font-size: 18px;
            color: #333;
        }
        
        .day-content-wrapper {
            padding: 0 15px 15px;
        }
        
        /* Êó∂Èó¥ÊÆµÊ†∑Âºè */
        .time-period {
            margin: 15px 0;
            border: 1px solid #eee;
            border-radius: 8px;
            overflow: hidden;
        }
        
        .period-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 15px;
            background: #f5f5f7;
            cursor: pointer;
        }
        
        .period-name {
            font-weight: 500;
            color: #333;
        }
        
        .period-details {
            padding: 15px;
            background: #fff;
        }
        
        .period-items {
            margin: 0;
            padding-left: 20px;
        }
        
        .period-items li {
            margin-bottom: 10px;
            line-height: 1.5;
        }
        
        .no-content {
            color: #999;
            font-style: italic;
        }
        
        /* ÂΩìÊó•‰ø°ÊÅØÂ∫ïÈÉ® */
        .day-info-footer {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px dashed #eee;
        }
        
        .transport-info, .food-info {
            flex: 1;
            min-width: 200px;
            padding: 10px;
            background: #f9f9f9;
            border-radius: 6px;
        }
        
        /* ÊåâÈíÆÊ†∑Âºè */
        .toggle-day-details, .toggle-period-details {
            background: transparent;
            border: none;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: background 0.2s;
        }
        
        .toggle-day-details:hover, .toggle-period-details:hover {
            background: rgba(0,0,0,0.05);
        }
        
        /* ÂÖ∂‰ªñÊ†áÁ≠æÈ°µÂÜÖÂÆπÊ†∑Âºè */
        .accommodations-content, .food-content, .tips-content {
            margin-bottom: 20px;
        }
        
        .section-title {
            margin-top: 0;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid #eee;
            color: #333;
        }
        
        .acc-list, .food-list, .tips-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .acc-item, .food-item, .tip-item {
            padding: 15px;
            background: #f9f9f9;
            border-radius: 8px;
            box-shadow: 0 1px 2px rgba(0,0,0,0.05);
        }
        
        /* Ê¥ªÂä®ËØ¶ÊÉÖÂÜÖÂÆπ */
        .activity-details {
            margin-top: 8px;
            padding-left: 10px;
            border-left: 2px solid #eee;
        }
        
        .detail-item {
            margin-bottom: 5px;
            color: #666;
            font-size: 14px;
        }
        
        .activity-main {
            font-weight: 500;
            color: #333;
        }
        
        /* ÂìçÂ∫îÂºèË∞ÉÊï¥ */
        @media (max-width: 768px) {
            .tabs-nav {
                flex-wrap: nowrap;
            }
            
            .tab-btn {
                padding: 10px 15px;
                font-size: 14px;
            }
            
            .tabs-content {
                padding: 15px;
            }
            
            .day-header {
                padding: 12px 15px;
            }
            
            .day-header h3 {
                font-size: 16px;
            }
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- ÂØºËà™Ê†èÂ∞ÜÁî± JavaScript Âä®ÊÄÅÊ∑ªÂä† -->

    <div class="h-screen flex">
        <!-- ËÅäÂ§©Âå∫Âüü -->
        <div id="chat-container" class="flex-1 flex flex-col bg-gray-50 relative">
            <!-- ËÅäÂ§©Â§¥ÈÉ® -->
            <div class="chat-header">
                <h1>‰∏éÊóÖË°åËßÑÂàíÂ∏àÂ∞èÂë®ÂØπËØù</h1>
                <p>ÂëäËØâÊàë‰Ω†ÁöÑÊóÖË°åÈúÄÊ±ÇÔºåÊàë‰ºö‰∏∫‰Ω†ÂÆöÂà∂ÂÆåÁæéË°åÁ®ã</p>
                
                <!-- Â§¥ÈÉ®Êìç‰ΩúÊåâÈíÆ -->
                <div class="absolute right-4 top-4 flex items-center gap-2">
                    <!-- APIÊµãËØïÊåâÈíÆ -->
                    <button id="test-api" class="chat-action-button" title="ÊµãËØïAPIËøûÊé•">
                        <i class="fas fa-plug"></i>
                    </button>
                    <button id="clear-chat" class="chat-action-button" title="Ê∏ÖÈô§ËÅäÂ§©ËÆ∞ÂΩï">
                        <i class="fas fa-trash-alt"></i>
                    </button>
                </div>
            </div>
            
            <!-- ËÅäÂ§©Ê∂àÊÅØÂå∫Âüü -->
            <div class="chat-messages">
                <!-- Ê∂àÊÅØÂÜÖÂÆπÂ∞ÜÈÄöËøáJSÂä®ÊÄÅÊ∑ªÂä† -->
                <div class="date-separator">
                    <span class="date-text">‰ªäÂ§©</span>
                </div>
            </div>
            
            <!-- Âª∫ËÆÆÊåâÈíÆÂå∫Âüü -->
            <div class="suggestion-container">
                <div id="suggestion-buttons" class="flex space-x-2 overflow-x-auto">
                    <!-- Âª∫ËÆÆÊåâÈíÆ‰ºöÂú®JS‰∏≠Âä®ÊÄÅÊ∑ªÂä† -->
                </div>
            </div>
            
            <!-- ËæìÂÖ•Âå∫Âüü -->
            <div class="chat-input-container">
                <!-- ÈôÑÂä†ÂäüËÉΩÊåâÈíÆ -->
                <div class="chat-extra-actions">
                    <button class="chat-action-button" id="upload-button" title="‰∏ä‰º†ÂõæÁâá">
                        <i class="fas fa-image"></i>
                    </button>
                    <button class="chat-action-button" id="location-button" title="ÂàÜ‰∫´‰ΩçÁΩÆ">
                        <i class="fas fa-map-marker-alt"></i>
                    </button>
                    <button class="chat-action-button" id="voice-button" title="ËØ≠Èü≥ËæìÂÖ•">
                        <i class="fas fa-microphone"></i>
                    </button>
                </div>
                
                <div class="chat-input-wrapper">
                    <input id="message-input" type="text" placeholder="ËæìÂÖ•‰Ω†ÁöÑÊóÖË°åÈúÄÊ±Ç„ÄÅÈóÆÈ¢òÊàñÁõÆÁöÑÂú∞..." class="flex-1">
                    <button id="send-button" aria-label="ÂèëÈÄÅÊ∂àÊÅØ">
                        <i class="fas fa-paper-plane"></i>
                    </button>
                </div>
                
                <p class="chat-input-hint">‰æãÂ¶ÇÔºö"Â∏ÆÊàëËßÑÂàí‰∏ÄÊ¨°Êó•Êú¨7Â§©‰πãÊóÖ" Êàñ "Êé®ËçêÈÄÇÂêà12Êúà‰ªΩÂéªÁöÑÁõÆÁöÑÂú∞"</p>
            </div>
        </div>
    </div>

    <!-- ÂàÜ‰∫´ËèúÂçï Modal -->
    <div id="share-modal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden items-center justify-center">
        <div class="bg-white rounded-xl p-5 max-w-md w-full mx-4">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-lg font-semibold">ÂàÜ‰∫´ÊóÖË°åËÆ°Âàí</h3>
                <button id="close-share-modal" class="text-gray-500 hover:text-gray-700">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="grid grid-cols-3 gap-4 mb-4">
                <button class="flex flex-col items-center p-3 hover:bg-gray-100 rounded-lg">
                    <div class="w-10 h-10 bg-green-500 rounded-full flex items-center justify-center text-white mb-2">
                        <i class="fab fa-weixin text-lg"></i>
                    </div>
                    <span class="text-xs">ÂæÆ‰ø°</span>
                </button>
                <button class="flex flex-col items-center p-3 hover:bg-gray-100 rounded-lg">
                    <div class="w-10 h-10 bg-blue-500 rounded-full flex items-center justify-center text-white mb-2">
                        <i class="far fa-envelope text-lg"></i>
                    </div>
                    <span class="text-xs">ÈÇÆ‰ª∂</span>
                </button>
                <button class="flex flex-col items-center p-3 hover:bg-gray-100 rounded-lg">
                    <div class="w-10 h-10 bg-purple-500 rounded-full flex items-center justify-center text-white mb-2">
                        <i class="fas fa-link text-lg"></i>
                    </div>
                    <span class="text-xs">Â§çÂà∂ÈìæÊé•</span>
                </button>
            </div>
            <div class="mt-4 pt-4 border-t border-gray-200">
                <button class="w-full bg-blue-600 text-white py-2 rounded-lg font-medium">
                    ‰øùÂ≠òÂà∞ÊàëÁöÑË°åÁ®ã
                </button>
            </div>
        </div>
    </div>
    
    <!-- ËØ≠Èü≥ËæìÂÖ• Modal -->
    <div id="voice-modal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden items-center justify-center">
        <div class="bg-white rounded-xl p-5 max-w-md w-full mx-4 text-center">
            <div class="mb-4">
                <div class="w-20 h-20 bg-blue-100 rounded-full mx-auto flex items-center justify-center">
                    <i id="voice-icon" class="fas fa-microphone text-blue-600 text-3xl"></i>
                </div>
            </div>
            <p id="voice-status" class="mb-3">ÁÇπÂáªÂºÄÂßãÂΩïÈü≥</p>
            <div class="flex justify-center gap-4">
                <button id="start-voice" class="px-4 py-2 bg-blue-600 text-white rounded-lg">
                    ÂºÄÂßãÂΩïÈü≥
                </button>
                <button id="stop-voice" class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hidden">
                    ÂÅúÊ≠¢ÂΩïÈü≥
                </button>
                <button id="close-voice-modal" class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg">
                    ÂèñÊ∂à
                </button>
            </div>
        </div>
    </div>

    <!-- Core Scripts -->
    <script src="js/config.js"></script>
    <script src="js/utils.js"></script>
    <script>
        // Ê£ÄÊü•ÈÖçÁΩÆÊòØÂê¶Ê≠£Á°ÆÂä†ËΩΩ
        if (!window.AppConfig || !window.AppConfig.API_CONFIG) {
            console.error('ÈÖçÁΩÆÂä†ËΩΩÂ§±Ë¥•ÔºåÂ∞Ü‰ΩøÁî®Á¶ªÁ∫øÊ®°Âºè');
        }
    </script>
    
    <!-- ÂºïÂÖ•Êô∫ËÉΩË°®ÂçïÈ¢ÑÂ°´ÂÖÖÊ®°Âùó -->
    <script src="js/modules/context-cache.js"></script>
    <script src="js/modules/conversation-analyzer.js"></script>
    <script src="js/modules/form-prefill-manager.js"></script>
    <script src="js/modules/module-loader.js"></script>
    <script src="js/modules/bootstrap.js"></script>
    <script src="js/modules/form-integration.js"></script>
    
    <!-- Application Scripts -->
    <script src="js/api.js"></script>
    <script src="js/itinerary-validator.js"></script>
    <script src="js/main.js"></script>
    <script src="js/chat.js"></script>
    <script src="js/components/nav-menu.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // ÂàùÂßãÂåñÂØºËà™ËèúÂçïÁªÑ‰ª∂
            if (typeof GlobalNavMenu !== 'undefined') {
                console.log('ÂàùÂßãÂåñÂØºËà™ËèúÂçïÁªÑ‰ª∂');
                new GlobalNavMenu();
            }
            
            // ÂàùÂßãÂåñËÅäÂ§©
            console.log('ÂàùÂßãÂåñËÅäÂ§©ÁªÑ‰ª∂');
            if (typeof window.initChat === 'function') {
                window.initChat();
            } else if (window.ChatModule && window.ChatModule.initChat) {
                window.ChatModule.initChat();
            } else {
                console.error('ËÅäÂ§©ÂàùÂßãÂåñÂáΩÊï∞Êú™ÊâæÂà∞');
            }
            
            let isFromHomepage = false;
            let initializationAttempts = 0;
            const maxInitAttempts = 20; // ÊúÄÂ§öÂ∞ùËØï20Ê¨°
            
            // Ê£ÄÊü•Ê®°ÂùóÊòØÂê¶ÈÉΩÂ∑≤Âä†ËΩΩ
            function checkModulesLoaded() {
                return window.AppConfig && 
                       window.AppUtils && 
                       window.TravelAI && 
                       window.ChatModule;
            }
            
            // ÂàùÂßãÂåñËÅäÂ§©Ê®°Âùó
            function initChat() {
                console.log('Â∞ùËØïÂàùÂßãÂåñËÅäÂ§©Ê®°Âùó...');
                console.log('Ê®°ÂùóÁä∂ÊÄÅ:', {
                    AppConfig: !!window.AppConfig,
                    AppUtils: !!window.AppUtils,
                    TravelAI: !!window.TravelAI,
                    ChatModule: !!window.ChatModule
                });
                
                initializationAttempts++;
                
                // Ê£ÄÊü•ÊâÄÊúâÂøÖÈúÄÁöÑÊ®°ÂùóÊòØÂê¶Â∑≤Âä†ËΩΩ
                if (!checkModulesLoaded()) {
                    if (initializationAttempts < maxInitAttempts) {
                        console.log(`Á≠âÂæÖÊ®°ÂùóÂä†ËΩΩ... (${initializationAttempts}/${maxInitAttempts})`);
                        setTimeout(initChat, 200);
                        return;
                    } else {
                        console.warn('Ê®°ÂùóÂä†ËΩΩË∂ÖÊó∂Ôºå‰ΩøÁî®Êú¨Âú∞Ê®°Âºè');
                    }
                }
                
                // Èò≤Ê≠¢ÈáçÂ§çÂàùÂßãÂåñ
                if (window.isChatInitialized) {
                    console.log('ËÅäÂ§©Ê®°ÂùóÂ∑≤ÁªèÂàùÂßãÂåñËøáÔºåË∑≥ËøáÈáçÂ§çÂàùÂßãÂåñ');
                    return;
                }
                
                // ÂàùÂßãÂåñËÅäÂ§©Ê®°Âùó
                if (window.ChatModule && typeof window.ChatModule.init === 'function') {
                    console.log('ÂºÄÂßãÂàùÂßãÂåñËÅäÂ§©Ê®°Âùó');
                    window.ChatModule.init({
                        skipWelcomeMessage: isFromHomepage,
                        useLocalMode: !window.TravelAI
                    });
                    window.isChatInitialized = true;
                    console.log('ËÅäÂ§©Ê®°ÂùóÂàùÂßãÂåñÂÆåÊàê');
                    
                    // Â¶ÇÊûúÊúâURLÂèÇÊï∞ÔºåÂ§ÑÁêÜÂÆÉ
                    handleUrlParameters();
                } else {
                    console.error('ËÅäÂ§©Ê®°Âùó‰∏çÂèØÁî®');
                }
            }
            
            // Â§ÑÁêÜURLÂèÇÊï∞
            function handleUrlParameters() {
                const urlParams = new URLSearchParams(window.location.search);
                const question = urlParams.get('q');
                
                if (question && question.trim()) {
                    console.log('Êî∂Âà∞‰ªéÈ¶ñÈ°µ‰º†Êù•ÁöÑÈóÆÈ¢ò:', question);
                    isFromHomepage = true;
                    
                    const messageInput = document.getElementById('message-input');
                    if (messageInput) {
                        messageInput.value = decodeURIComponent(question);
                    }
                    
                    // Âª∂ËøüÂèëÈÄÅÊ∂àÊÅØÔºåÁ°Æ‰øùÊ®°ÂùóÂ∑≤ÂÆåÂÖ®ÂàùÂßãÂåñ
                    setTimeout(() => {
                        if (window.ChatModule && window.ChatModule.sendMessage) {
                            window.ChatModule.sendMessage();
                        } else {
                            console.error('ChatModule.sendMessage ‰∏çÂèØÁî®');
                        }
                    }, 1000);
                }
            }
            
            // ÂºÄÂßãÂàùÂßãÂåñ
            initChat();
            
            // Ê®°ÊÄÅÊ°ÜÊéßÂà∂
            const shareButtons = document.querySelectorAll('.share-button');
            const shareModal = document.getElementById('share-modal');
            const closeShareModal = document.getElementById('close-share-modal');
            
            if (shareButtons.length && shareModal && closeShareModal) {
                shareButtons.forEach(button => {
                    button.addEventListener('click', function() {
                        shareModal.style.display = 'flex';
                        document.body.style.overflow = 'hidden';
                    });
                });
                
                closeShareModal.addEventListener('click', function() {
                    shareModal.style.display = 'none';
                    document.body.style.overflow = '';
                });
                
                // ÁÇπÂáªÂºπÁ™óÂ§ñÂå∫Âüü‰πüÂèØÂÖ≥Èó≠
                shareModal.addEventListener('click', function(e) {
                    if (e.target === shareModal) {
                        shareModal.style.display = 'none';
                        document.body.style.overflow = '';
                    }
                });
                
                // Ê∑ªÂä†ESCÈîÆÂÖ≥Èó≠
                document.addEventListener('keydown', function(e) {
                    if (e.key === 'Escape' && shareModal.style.display === 'flex') {
                        shareModal.style.display = 'none';
                        document.body.style.overflow = '';
                    }
                });
            }
            
            // ËØ≠Èü≥Ê®°ÊÄÅÊ°ÜÊéßÂà∂
            const voiceButton = document.getElementById('voice-button');
            const voiceModal = document.getElementById('voice-modal');
            const closeVoiceModal = document.getElementById('close-voice-modal');
            const startVoice = document.getElementById('start-voice');
            const stopVoice = document.getElementById('stop-voice');
            const voiceStatus = document.getElementById('voice-status');
            const voiceIcon = document.getElementById('voice-icon');
            
            if (voiceButton && voiceModal && closeVoiceModal) {
                voiceButton.addEventListener('click', function() {
                    voiceModal.style.display = 'flex';
                    document.body.style.overflow = 'hidden';
                });
                
                closeVoiceModal.addEventListener('click', function() {
                    voiceModal.style.display = 'none';
                    document.body.style.overflow = '';
                });
                
                if (startVoice && stopVoice) {
                    startVoice.addEventListener('click', function() {
                        // Ê®°ÊãüËØ≠Èü≥ËØÜÂà´ÂºÄÂßã
                        startVoice.classList.add('hidden');
                        stopVoice.classList.remove('hidden');
                        voiceStatus.textContent = 'Ê≠£Âú®ÂΩïÈü≥...';
                        voiceIcon.classList.add('text-red-600');
                        
                        // Ê®°ÊãüÊ≥¢ÂΩ¢Âä®Áîª
                        voiceIcon.classList.add('fa-beat');
                    });
                    
                    stopVoice.addEventListener('click', function() {
                        // Ê®°ÊãüËØ≠Èü≥ËØÜÂà´ÁªìÊùü
                        startVoice.classList.remove('hidden');
                        stopVoice.classList.add('hidden');
                        voiceStatus.textContent = 'ËØÜÂà´‰∏≠...';
                        voiceIcon.classList.remove('fa-beat');
                        
                        // Ê®°ÊãüËØÜÂà´ÂÆåÊàê
                        setTimeout(() => {
                            voiceModal.style.display = 'none';
                            document.body.style.overflow = '';
                            
                            // Ê®°ÊãüÊ∑ªÂä†ËØÜÂà´ÁªìÊûúÂà∞ËæìÂÖ•Ê°Ü
                            const messageInput = document.getElementById('message-input');
                            if (messageInput) {
                                messageInput.value = 'ÊàëÊÉ≥ÂéªÊó•Êú¨ÊóÖÊ∏∏Ôºå7Â§©Â∑¶Âè≥ÔºåÊÉ≥ÁúãÊ®±Ëä±';
                                messageInput.focus();
                            }
                        }, 1500);
                    });
                }
            }
            
            // Ê∏ÖÈô§ËÅäÂ§©ËÆ∞ÂΩï
            const clearChat = document.getElementById('clear-chat');
            if (clearChat) {
                clearChat.addEventListener('click', function() {
                    if (confirm('Á°ÆËÆ§Ë¶ÅÊ∏ÖÈô§ÊâÄÊúâËÅäÂ§©ËÆ∞ÂΩïÂêóÔºü')) {
                        const chatMessages = document.querySelector('.chat-messages');
                        if (chatMessages) {
                            // ‰øùÁïôÊó•ÊúüÂàÜÈöîÁ∫ø
                            const dateSeparator = chatMessages.querySelector('.date-separator');
                            chatMessages.innerHTML = '';
                            if (dateSeparator) {
                                chatMessages.appendChild(dateSeparator);
                            }
                            
                            // ÈáçÁΩÆÂØπËØùÂéÜÂè≤
                            if (window.ChatModule && window.ChatModule.resetConversation) {
                                window.ChatModule.resetConversation();
                            }
                        }
                    }
                });
            }

            // Ê∑ªÂä†APIÊµãËØïÊåâÈíÆ‰∫ã‰ª∂Â§ÑÁêÜ
            const testApiBtn = document.getElementById('test-api');
            if (testApiBtn) {
                testApiBtn.addEventListener('click', async function() {
                    try {
                        if (!window.TravelAI || !window.TravelAI.testAPIConnection) {
                            alert('APIÊ®°ÂùóÊú™Â∞±Áª™ÔºåÊó†Ê≥ïÊµãËØïËøûÊé•');
                            return;
                        }
                        
                        testApiBtn.disabled = true;
                        testApiBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i>';
                        
                        const result = await window.TravelAI.testAPIConnection();
                        
                        if (result.success) {
                            alert('APIËøûÊé•ÊµãËØïÊàêÂäüÔºÅ');
                        } else {
                            alert(`APIËøûÊé•ÊµãËØïÂ§±Ë¥•: ${result.message}`);
                        }
                    } catch (error) {
                        console.error('ÊµãËØïAPIËøûÊé•Êó∂Âá∫Èîô:', error);
                        alert(`ÊµãËØïAPIËøûÊé•Êó∂Âá∫Èîô: ${error.message || 'Êú™Áü•ÈîôËØØ'}`);
                    } finally {
                        testApiBtn.disabled = false;
                        testApiBtn.innerHTML = '<i class="fas fa-plug"></i>';
                    }
                });
            }
        });
    </script>

    <!-- Ë°åÁ®ãÂ±ïÁ§∫‰ºòÂåñÁöÑJavaScriptÂáΩÊï∞ -->
    <script>
        // ÂàáÊç¢Êó∂Èó¥ÊÆµËØ¶ÊÉÖÊòæÁ§∫/ÈöêËóè
        function togglePeriodDetails(element) {
            const details = element.closest('.time-period').querySelector('.period-details');
            const button = element.querySelector('.toggle-period-details');
            const icon = button.querySelector('i');
            
            if (details.classList.contains('hidden')) {
                details.classList.remove('hidden');
                button.setAttribute('aria-expanded', 'true');
                icon.classList.remove('fa-chevron-down');
                icon.classList.add('fa-chevron-up');
            } else {
                details.classList.add('hidden');
                button.setAttribute('aria-expanded', 'false');
                icon.classList.remove('fa-chevron-up');
                icon.classList.add('fa-chevron-down');
            }
        }
        
        // ÂàáÊç¢Ê¥ªÂä®ËØ¶ÊÉÖÊòæÁ§∫/ÈöêËóè
        function toggleActivityDetails(element) {
            const details = element.closest('.activity-item').querySelector('.activity-details');
            const button = element.querySelector('.toggle-activity-details');
            const icon = button.querySelector('i');
            
            if (details.classList.contains('hidden')) {
                details.classList.remove('hidden');
                button.setAttribute('aria-expanded', 'true');
                icon.classList.remove('fa-chevron-down');
                icon.classList.add('fa-chevron-up');
            } else {
                details.classList.add('hidden');
                button.setAttribute('aria-expanded', 'false');
                icon.classList.remove('fa-chevron-up');
                icon.classList.add('fa-chevron-down');
            }
        }
        
        // ÂÖ®Â±Ä‰∫ã‰ª∂ÁõëÂê¨Âô®ÔºåÂ§ÑÁêÜÂä®ÊÄÅÊ∑ªÂä†ÁöÑË°åÁ®ãÂÖÉÁ¥†
        document.addEventListener('click', function(e) {
            // Â§ÑÁêÜTabÂàáÊç¢
            if (e.target.classList.contains('tab-btn') || e.target.closest('.tab-btn')) {
                const btn = e.target.classList.contains('tab-btn') ? e.target : e.target.closest('.tab-btn');
                const tabId = 'tab-' + btn.dataset.tab;
                const tabContainer = btn.closest('.itinerary-tabs');
                
                if (tabContainer) {
                    // ÁßªÈô§ÊâÄÊúâÊ¥ªÂä®Áä∂ÊÄÅ
                    tabContainer.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
                    tabContainer.querySelectorAll('.tab-pane').forEach(p => p.classList.remove('active'));
                    
                    // ËÆæÁΩÆÂΩìÂâçÊ¥ªÂä®Tab
                    btn.classList.add('active');
                    const tabPane = tabContainer.querySelector('#' + tabId);
                    if (tabPane) {
                        tabPane.classList.add('active');
                    }
                }
            }
            
            // Â§ÑÁêÜÂ§©Êï∞ÂØºËà™ÂàáÊç¢
            if (e.target.classList.contains('day-nav-btn') || e.target.closest('.day-nav-btn')) {
                const btn = e.target.classList.contains('day-nav-btn') ? e.target : e.target.closest('.day-nav-btn');
                const dayNum = btn.dataset.day;
                const dailyContent = btn.closest('.daily-content') || btn.closest('#tab-daily');
                
                if (dailyContent) {
                    // ÁßªÈô§ÊâÄÊúâÊ¥ªÂä®Áä∂ÊÄÅ
                    dailyContent.querySelectorAll('.day-nav-btn').forEach(b => b.classList.remove('active'));
                    dailyContent.querySelectorAll('.day-detail').forEach(d => d.classList.remove('active'));
                    
                    // ËÆæÁΩÆÂΩìÂâçÊ¥ªÂä®Â§©
                    btn.classList.add('active');
                    const dayDetail = dailyContent.querySelector('.day-detail[data-day="' + dayNum + '"]');
                    if (dayDetail) {
                        dayDetail.classList.add('active');
                    }
                }
            }
            
            // Â§ÑÁêÜÊó∂Èó¥ÊÆµÊäòÂè†/Â±ïÂºÄ
            if (e.target.classList.contains('period-header') || e.target.closest('.period-header')) {
                const header = e.target.classList.contains('period-header') ? e.target : e.target.closest('.period-header');
                togglePeriodDetails(header);
            }
            
            // Â§ÑÁêÜÊ¥ªÂä®ÊäòÂè†/Â±ïÂºÄ
            if (e.target.classList.contains('activity-header') || e.target.closest('.activity-header')) {
                const header = e.target.classList.contains('activity-header') ? e.target : e.target.closest('.activity-header');
                toggleActivityDetails(header);
            }
        });
        
        // Âú®Ë°åÁ®ãÁîüÊàêÂêéÂàùÂßãÂåñUI
        function initItineraryUI() {
            // Ëé∑ÂèñÊâÄÊúâÊó∂Èó¥ÊÆµËØ¶ÊÉÖÂπ∂ÈªòËÆ§ÊäòÂè†ÈùûÁ¨¨‰∏Ä‰∏™
            const timeperiods = document.querySelectorAll('.time-period');
            timeperiods.forEach((period, index) => {
                if (index > 0) { // ÈªòËÆ§Âè™Â±ïÂºÄÁ¨¨‰∏Ä‰∏™Êó∂Èó¥ÊÆµ
                    const details = period.querySelector('.period-details');
                    const button = period.querySelector('.toggle-period-details');
                    const icon = button.querySelector('i');
                    
                    if (details && !details.classList.contains('hidden')) {
                        details.classList.add('hidden');
                        button.setAttribute('aria-expanded', 'false');
                        if (icon) {
                            icon.classList.remove('fa-chevron-up');
                            icon.classList.add('fa-chevron-down');
                        }
                    }
                }
            });
            
            // ÊâÄÊúâÊ¥ªÂä®ÈªòËÆ§ÊäòÂè†
            const activities = document.querySelectorAll('.activity-details');
            activities.forEach(activity => {
                if (!activity.classList.contains('hidden')) {
                    activity.classList.add('hidden');
                    const button = activity.closest('.activity-item').querySelector('.toggle-activity-details');
                    if (button) {
                        button.setAttribute('aria-expanded', 'false');
                        const icon = button.querySelector('i');
                        if (icon) {
                            icon.classList.remove('fa-chevron-up');
                            icon.classList.add('fa-chevron-down');
                        }
                    }
                }
            });
        }
        
        // ÁõëÂê¨DOMÂèòÂåñÔºåÊ£ÄÊµãÊñ∞Ê∑ªÂä†ÁöÑË°åÁ®ã
        const observer = new MutationObserver(function(mutations) {
            mutations.forEach(function(mutation) {
                if (mutation.addedNodes && mutation.addedNodes.length > 0) {
                    // Ê£ÄÊü•Êñ∞Ê∑ªÂä†ÁöÑËäÇÁÇπÊòØÂê¶ÂåÖÂê´Ë°åÁ®ãÂÆπÂô®
                    for (let i = 0; i < mutation.addedNodes.length; i++) {
                        const node = mutation.addedNodes[i];
                        if (node.nodeType === 1 && (
                            node.classList.contains('itinerary-container') || 
                            node.querySelector('.itinerary-container')
                        )) {
                            // Âª∂ËøüÊâßË°åÂàùÂßãÂåñÔºåÁ°Æ‰øùDOMÂ∑≤ÂÆåÂÖ®Êõ¥Êñ∞
                            setTimeout(initItineraryUI, 300);
                            break;
                        }
                    }
                }
            });
        });
        
        // ÈÖçÁΩÆËßÇÂØüÂô®
        observer.observe(document.body, {
            childList: true,
            subtree: true
        });
        
        // È°µÈù¢Âä†ËΩΩÊó∂‰πüÂàùÂßãÂåñ‰∏ÄÊ¨°
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(initItineraryUI, 300);
        });
    </script>
</body>
</html> 